<!DOCTYPE html>
<html lang="tr">
<head>
    <!-- HEAD KISMI dashboard.html ile aynı kalacak -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sayfa Yönetimi - Elçi Veteriner Yönetim</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Önceki CSS tanımları aynen kalacak */
        /* Yeni eklenen stil tanımları */
        .page-manager {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .page-list {
            list-style: none;
            margin-top: 20px;
        }
        
        .page-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
            transition: var(--transition);
        }
        
        .page-item:hover {
            background: var(--primary-light);
        }
        
        .page-item:last-child {
            border-bottom: none;
        }
        
        .page-info {
            flex: 1;
        }
        
        .page-title {
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .page-title i {
            margin-right: 10px;
            color: var(--secondary);
        }
        
        .page-path {
            font-size: 13px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .page-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-edit, .btn-delete, .btn-preview {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }
        
        .btn-edit {
            background: var(--info-light);
            color: var(--info);
        }
        
        .btn-edit:hover {
            background: var(--info);
            color: white;
        }
        
        .btn-delete {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .btn-delete:hover {
            background: var(--danger);
            color: white;
        }
        
        .btn-preview {
            background: var(--success-light);
            color: var(--success);
        }
        
        .btn-preview:hover {
            background: var(--success);
            color: white;
        }
        
        .editor-container {
            display: none;
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .editor-toolbar {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .editor-toolbar button {
            padding: 8px 12px;
            background: var(--light);
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            cursor: pointer;
        }
        
        #pageContent {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
        }
        
        .editor-footer {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
    </style>
</head>
<body>
    <!-- Sidebar (dashboard.html ile aynı) -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../assets/img/logo-icon.png" alt="Elçi Veteriner">
            <h3>Elçi Veteriner</h3>
        </div>
        
        <div class="sidebar-menu">
            <ul>
                <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="admin_panel.html" class="active"><i class="fas fa-file-alt"></i> Sayfa Yönetimi</a></li>
                <!-- Diğer menü öğeleri -->
            </ul>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Navbar (dashboard.html ile aynı) -->
        <div class="navbar">
            <!-- Navbar içeriği -->
        </div>
        
        <!-- Content -->
        <div class="content">
            <div class="page-title">
                <h2><i class="fas fa-file-alt"></i> Sayfa Yönetimi</h2>
                <p>Sitenizdeki tüm sayfaları görüntüleyip düzenleyebilirsiniz.</p>
            </div>
            
            <!-- Sayfa Listesi -->
            <div class="page-manager">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Tüm Sayfalar</h3>
                    <button class="btn-sm" id="refreshPages"><i class="fas fa-sync-alt"></i> Yenile</button>
                </div>
                
                <ul class="page-list" id="pageList">
                    <!-- Sayfalar buraya dinamik olarak eklenecek -->
                </ul>
            </div>
            
            <!-- Sayfa Düzenleyici -->
            <div class="editor-container" id="editorContainer">
                <div class="editor-header">
                    <h3 id="editorTitle">Sayfa Düzenle</h3>
                    <button class="btn-sm" id="closeEditor"><i class="fas fa-times"></i> Kapat</button>
                </div>
                
                <div class="editor-toolbar">
                    <button onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                    <button onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                    <button onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                    <button onclick="insertHeading()"><i class="fas fa-heading"></i></button>
                    <button onclick="insertLink()"><i class="fas fa-link"></i></button>
                    <button onclick="insertImage()"><i class="fas fa-image"></i></button>
                    <button onclick="insertTable()"><i class="fas fa-table"></i></button>
                </div>
                
                <div id="pageContent" contenteditable="true"></div>
                
                <div class="editor-footer">
                    <button class="btn-edit" id="saveChanges"><i class="fas fa-save"></i> Değişiklikleri Kaydet</button>
                    <button class="btn-delete" id="cancelEdit"><i class="fas fa-times"></i> İptal</button>
                </div>
            </div>
            
            <!-- Önizleme Modali -->
            <div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; padding:50px;">
                <div style="background:white; border-radius:10px; padding:20px; height:90%; overflow:auto;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                        <h3>Sayfa Önizleme</h3>
                        <button onclick="document.getElementById('previewModal').style.display='none'" style="background:var(--danger); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Kapat</button>
                    </div>
                    <iframe id="previewFrame" style="width:100%; height:90%; border:none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sayfa listesini yükleme
        document.addEventListener('DOMContentLoaded', function() {
            loadPages();
            
            // Yenile butonu
            document.getElementById('refreshPages').addEventListener('click', loadPages);
            
            // Editör kapatma
            document.getElementById('closeEditor').addEventListener('click', function() {
                document.getElementById('editorContainer').style.display = 'none';
            });
            
            // İptal butonu
            document.getElementById('cancelEdit').addEventListener('click', function() {
                if(confirm('Değişiklikler kaydedilmeden kapatılacak. Emin misiniz?')) {
                    document.getElementById('editorContainer').style.display = 'none';
                }
            });
        });
        
        // Sayfaları yükle
        function loadPages() {
            fetch('/?no-cache=1')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = Array.from(doc.querySelectorAll('a[href$=".html"]'));
                    
                    const uniquePages = [...new Set(links.map(link => {
                        const url = new URL(link.href, window.location.origin);
                        return {
                            path: url.pathname,
                            name: link.textContent.trim() || url.pathname.split('/').pop()
                        };
                    }))];
                    
                    // Ana sayfayı ekle
                    uniquePages.push({
                        path: '/index.html',
                        name: 'Ana Sayfa'
                    });
                    
                    // Admin sayfalarını filtrele
                    const filteredPages = uniquePages.filter(page => 
                        !page.path.includes('admin/') && 
                        page.path !== '/404.html' && 
                        page.path !== '/'
                    );
                    
                    const pageList = document.getElementById('pageList');
                    pageList.innerHTML = '';
                    
                    filteredPages.forEach(page => {
                        const li = document.createElement('li');
                        li.className = 'page-item';
                        li.innerHTML = `
                            <div class="page-info">
                                <div class="page-title">
                                    <i class="fas fa-file-alt"></i> ${page.name}
                                </div>
                                <div class="page-path">${page.path}</div>
                            </div>
                            <div class="page-actions">
                                <button class="btn-preview" onclick="previewPage('${page.path}')">
                                    <i class="fas fa-eye"></i> Önizleme
                                </button>
                                <button class="btn-edit" onclick="editPage('${page.path}')">
                                    <i class="fas fa-edit"></i> Düzenle
                                </button>
                            </div>
                        `;
                        pageList.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error('Sayfalar yüklenirken hata oluştu:', error);
                    alert('Sayfalar yüklenirken bir hata oluştu. Lütfen konsolu kontrol edin.');
                });
        }
        
        // Sayfa önizleme
        function previewPage(path) {
            const previewModal = document.getElementById('previewModal');
            const previewFrame = document.getElementById('previewFrame');
            
            previewFrame.src = path;
            previewModal.style.display = 'block';
        }
        
        // Sayfa düzenleme
        function editPage(path) {
            fetch(path)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('editorTitle').textContent = path.split('/').pop() + ' - Düzenle';
                    document.getElementById('pageContent').innerHTML = html;
                    document.getElementById('editorContainer').style.display = 'block';
                    
                    // Kaydet butonuna path bilgisini ekle
                    document.getElementById('saveChanges').onclick = function() {
                        savePage(path);
                    };
                })
                .catch(error => {
                    console.error('Sayfa yüklenirken hata oluştu:', error);
                    alert('Sayfa yüklenirken bir hata oluştu. Lütfen konsolu kontrol edin.');
                });
        }
        
        // Sayfayı kaydetme
        function savePage(path) {
            const content = document.getElementById('pageContent').innerHTML;
            
            // Burada GitHub API kullanarak dosyayı güncelleyeceğiz
            alert('Bu örnekte dosya kaydetme işlemi GitHub API entegrasyonu gerektirir.\n\nGerçek uygulamada bu kısım GitHub API ile dosya güncelleme yapacak.');
            console.log('Kaydedilecek sayfa:', path);
            console.log('İçerik:', content);
            
            // Örnek API isteği (gerçekte çalışması için token gerekli)
            /*
            fetch('https://api.github.com/repos/kullanici/repo/contents/' + path, {
                method: 'PUT',
                headers: {
                    'Authorization': 'token YOUR_GITHUB_TOKEN',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Sayfa güncelleme: ' + path,
                    content: btoa(unescape(encodeURIComponent(content))),
                    sha: 'Dosyanın mevcut SHA değeri'
                })
            })
            .then(response => response.json())
            .then(data => {
                alert('Sayfa başarıyla güncellendi!');
                document.getElementById('editorContainer').style.display = 'none';
            })
            .catch(error => {
                console.error('Sayfa güncellenirken hata oluştu:', error);
                alert('Sayfa güncellenirken bir hata oluştu. Lütfen konsolu kontrol edin.');
            });
            */
        }
        
        // Metin düzenleme fonksiyonları
        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('pageContent').focus();
        }
        
        function insertHeading() {
            const level = prompt('Başlık seviyesi girin (1-6):', '2');
            if (level >= 1 && level <= 6) {
                formatText('formatBlock', '<h' + level + '>');
            }
        }
        
        function insertLink() {
            const url = prompt('Link URL girin:', 'https://');
            if (url) {
                formatText('createLink', url);
            }
        }
        
        function insertImage() {
            const url = prompt('Resim URL girin:', 'https://');
            if (url) {
                formatText('insertImage', url);
            }
        }
        
        function insertTable() {
            const rows = prompt('Satır sayısı:', '3');
            const cols = prompt('Sütun sayısı:', '3');
            
            if (rows && cols) {
                let table = '<table border="1" style="width:100%; border-collapse:collapse;">';
                for (let i = 0; i < rows; i++) {
                    table += '<tr>';
                    for (let j = 0; j < cols; j++) {
                        table += '<td style="padding:8px;">Örnek</td>';
                    }
                    table += '</tr>';
                }
                table += '</table>';
                
                document.execCommand('insertHTML', false, table);
            }
        }
    </script>
</body>
</html>
